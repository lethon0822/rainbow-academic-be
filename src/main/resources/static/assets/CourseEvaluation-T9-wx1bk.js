import{r as a,u as Q,z as H,q as D,k as J,c as u,o as i,b as s,H as n,f as g,Y,e as m,F as G,E as W,g as X,v as Z,J as ee,w as se,P as h}from"./index-BYEgPVgA.js";const te={class:"survey-container"},le={class:"course-info"},oe={key:0,class:"loading-container"},ae={key:1,class:"error-container"},ne={class:"error-message"},re={key:2,class:"row"},ue={class:"col-md-6"},ie={class:"col-md-6"},ce={class:"progress"},de={class:"text-center text-muted mb-4"},ve={key:0,class:"survey-item"},pe={class:"question-header"},me={class:"question-number"},be={class:"question-text"},ye={class:"rating-container"},_e={class:"rating-scale"},fe={class:"rating-label"},ge={class:"rating-input-wrapper"},he=["name","id","value","data-value","onInput","checked","disabled"],qe={key:1,class:"survey-item"},Ie={class:"rating-container"},we=["disabled"],ke={class:"survey-footer"},xe=["disabled"],Se=["disabled"],Ce=["disabled"],De=["disabled"],Ee={key:2,class:"alert alert-success mt-4"},d=5,Pe={__name:"CourseEvaluation",props:{courseId:String},setup(E){const N=E,q=a(null),P=a(!0),L=Q(),O=H(),b=a(N.courseId||O.query.courseId||""),c=a({q1:null,q2:null,q3:null,q4:null,q5:null}),I=a(0),r=a(!1),y=a(""),o=a(1),v=a({courseId:null,title:"",credit:"",professorName:"",type:"",classroom:"",year:"",semester:"",evaluation_date:""}),w=a(!0),_=a(null),k=a(null),S=[{number:1,question:"수업내용이 체계적으로 구성되었다."},{number:2,question:"교수의 강의 진행 속도가 적절하다."},{number:3,question:"수업 자료(PPT, 교재 등)가 이해하기 쉽게 준비되었다."},{number:4,question:"교수가 학생들의 질문에 성실히 답변해준다."},{number:5,question:"이 강의를 다른 학생들에게 추천하고 싶다."}],j=[{label:"매우 그렇지 않다",value:1},{label:"그렇지 않다",value:2},{label:"보통이다",value:3},{label:"그렇다",value:4},{label:"매우 그렇다",value:5}],M=async()=>{var t,e;try{const l=await h.get("/account/check");q.value=l.data,console.log("현재 사용자 ID:",q.value)}catch(l){console.error("사용자 정보 로드 실패:",l),(((t=l.response)==null?void 0:t.status)===401||!((e=l.response)!=null&&e.data))&&alert("로그인이 필요합니다.")}finally{P.value=!1}},R=t=>h.get(`/course/${t}`).catch(e=>e.response),C=async()=>{try{w.value=!0,_.value=null;const t=await R(b.value);if(t&&t.data){const e=t.data;v.value={courseId:e.courseId||null,title:e.title||"과목명 정보 없음",credit:e.credit!==void 0?e.credit:"학점 정보 없음",professorName:e.userName||"교수명 정보 없음",type:e.type||"이수구분 정보 없음",classroom:e.classroom||"강의실 정보 없음",year:e.year||"년도 정보 없음",semester:e.semester||"학기 정보 없음",evaluation_date:new Date().toLocaleDateString("ko-KR")}}else throw new Error("강의 정보를 불러올 수 없습니다.")}catch(t){console.error("강의 정보 로드 실패:",t),_.value=t.message||"강의 정보를 불러오는 중 오류가 발생했습니다.",v.value={courseId:null,title:"강의 정보 로드 실패",credit:"정보 없음",professorName:"정보 없음",type:"이수구분 정보 없음",classroom:"정보 없음",year:"정보 없음",semester:"정보 없음",evaluation_date:new Date().toLocaleDateString("ko-KR")}}finally{w.value=!1}},A=async()=>{try{const t=`/student/course?courseId=${b.value}`;console.log("Enrollment API 호출 URL:",t);const l=(await h.get(t)).data.find(p=>p.courseId===parseInt(b.value));l?(k.value=l.enrollmentId,console.log("Enrollment ID:",k.value)):console.warn("해당 강의의 수강내역이 없습니다.")}catch(t){console.error("수강내역 로드 실패:",t)}},x=()=>{const t=Object.values(c.value).filter(e=>e!==null).length;I.value=Math.round(t/d*100)},T=t=>{c.value["q"+o.value]=t,x()},U=()=>{o.value<d&&o.value++},V=()=>{o.value>1&&o.value--},z=async()=>{var t;if(!q.value){alert("사용자 인증이 필요합니다. 다시 로그인해주세요.");return}if(Object.values(c.value).every(e=>e!==null)){const e=Object.values(c.value),l=Math.round(e.reduce((f,K)=>f+K,0)/e.length),p={enrollmentId:k.value,courseId:parseInt(b.value),review:y.value,evScore:l};console.log("설문 결과:",p);try{await h.put("/student/course/survey",p),r.value=!0,alert(`설문이 성공적으로 제출되었습니다!
소중한 의견 감사합니다.`),L.push("/grade/current")}catch(f){console.error("설문 제출 실패:",f),((t=f.response)==null?void 0:t.status)===401?alert("로그인 세션이 만료되었습니다. 다시 로그인해주세요."):alert("설문 제출에 실패했습니다. 다시 시도해주세요.")}}else alert("모든 필수 항목에 답변해주세요.")},B=()=>{confirm("작성한 내용이 모두 삭제됩니다. 계속하시겠습니까?")&&(Object.keys(c.value).forEach(t=>c.value[t]=null),y.value="",r.value=!1,x(),o.value=1)},F=D(()=>c.value["q"+o.value]!==null),$=D(()=>Object.values(c.value).every(t=>t!==null));return J(async()=>{x(),await Promise.all([M(),C()]),await A()}),(t,e)=>(i(),u("div",te,[e[10]||(e[10]=s("div",{class:"survey-header"},[s("h1",null,"중간강의평가 설문지")],-1)),s("div",le,[e[6]||(e[6]=s("h5",null,"📚 강의 정보",-1)),w.value?(i(),u("div",oe,e[1]||(e[1]=[s("div",{class:"spinner"},null,-1),s("p",null,"강의 정보를 불러오는 중...",-1)]))):_.value?(i(),u("div",ae,[s("p",ne,"⚠️ "+n(_.value),1),s("button",{onClick:C,class:"btn btn-sm btn-outline-primary"}," 다시 시도 ")])):(i(),u("div",re,[s("div",ue,[s("p",null,[e[2]||(e[2]=s("strong",null,"과목명:",-1)),g(" "+n(v.value.title),1)]),s("p",null,[e[3]||(e[3]=s("strong",null,"담당교수:",-1)),g(" "+n(v.value.professorName),1)])]),s("div",ie,[s("p",null,[e[4]||(e[4]=s("strong",null,"학점:",-1)),g(" "+n(v.value.credit)+"학점",1)]),s("p",null,[e[5]||(e[5]=s("strong",null,"이수구분:",-1)),g(" "+n(v.value.type),1)])])]))]),s("div",ce,[s("div",{class:"progress-bar",role:"progressbar",style:Y({width:I.value+"%"})},null,4)]),s("p",de," 진행률: "+n(I.value)+"% ("+n(o.value)+"/"+n(d+1)+"단계) ",1),s("form",{onSubmit:se(z,["prevent"]),class:ee({"form-disabled":r.value})},[o.value<=d?(i(),u("div",ve,[s("div",pe,[s("div",me,n(S[o.value-1].number),1),s("div",be,n(S[o.value-1].question),1)]),s("div",ye,[s("div",_e,[(i(),u(G,null,W(j,l=>s("div",{key:l.value,class:"rating-option"},[s("div",fe,n(l.label),1),s("div",ge,[s("input",{class:"rating-input",type:"radio",name:"q"+o.value,id:"q"+o.value+"_"+l.value,value:l.value,"data-value":l.value,onInput:p=>T(l.value),checked:c.value["q"+o.value]==l.value,disabled:r.value},null,40,he)])])),64))])])])):m("",!0),o.value===d+1?(i(),u("div",qe,[e[7]||(e[7]=s("div",{class:"question-header"},[s("div",{class:"question-number"},"💬"),s("div",{class:"question-text"}," 강의에 대한 추가 의견이나 개선사항이 있다면 자유롭게 작성해주세요. ")],-1)),s("div",Ie,[X(s("textarea",{class:"form-control opinion-textarea",rows:"6",placeholder:"강의 개선을 위한 의견을 자유롭게 작성해주세요...","onUpdate:modelValue":e[0]||(e[0]=l=>y.value=l),disabled:r.value},null,8,we),[[Z,y.value]])])])):m("",!0),s("div",ke,[s("button",{type:"button",class:"btn btn-outline-secondary btn-lg me-3",onClick:V,disabled:o.value===1||r.value}," ← 이전 ",8,xe),o.value<=d?(i(),u("button",{key:0,type:"button",class:"btn btn-primary btn-lg",onClick:U,disabled:!F.value||r.value}," 다음 → ",8,Se)):m("",!0),o.value===d+1?(i(),u("button",{key:1,type:"submit",class:"btn btn-success btn-lg",disabled:r.value||!$.value}," 📝 설문 제출 ",8,Ce)):m("",!0),s("button",{type:"button",class:"btn btn-outline-secondary btn-lg ms-3",onClick:B,disabled:r.value}," 🔄 다시 작성 ",8,De),e[8]||(e[8]=s("p",{class:"text-muted mt-3 mb-0"}," 익명으로 제출되며, 강의 개선에 소중한 자료로 활용됩니다. ",-1))]),r.value?(i(),u("div",Ee,e[9]||(e[9]=[s("h4",null,"🎉 제출 완료!",-1),s("p",null," 설문에 참여해주셔서 감사합니다. 더 나은 강의를 위해 소중한 의견을 반영하겠습니다. ",-1)]))):m("",!0)],34)]))}};export{Pe as default};
