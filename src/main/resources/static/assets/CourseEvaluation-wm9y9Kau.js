import{b as o,u as U,z as Q,q as S,k as $,c as r,o as i,a as s,H as n,K as f,X as H,f as p,F as J,E as X,g as G,v as W,J as Y,w as Z,O as w}from"./index-D6WQuHd6.js";const ee={class:"survey-container"},se={class:"course-info"},te={key:0,class:"loading-container"},le={key:1,class:"error-container"},ae={class:"error-message"},oe={key:2,class:"row"},ne={class:"col-md-6"},ue={class:"col-md-6"},re={class:"progress"},ie={class:"text-center text-muted mb-4"},ce={key:0,class:"survey-item"},de={class:"question-header"},ve={class:"question-number"},pe={class:"question-text"},be={class:"rating-container"},me={class:"rating-scale"},ye={class:"rating-label"},_e={class:"rating-input-wrapper"},fe=["name","id","value","data-value","onInput","checked","disabled"],ge={key:1,class:"survey-item"},he={class:"rating-container"},qe=["disabled"],ke={class:"survey-footer"},we=["disabled"],Ie=["disabled"],xe=["disabled"],Ce=["disabled"],Se={key:2,class:"alert alert-success mt-4"},d=5,Ne={__name:"CourseEvaluation",props:{courseId:String},setup(D){const b=o(null),N=o(!0),O=U(),E=D,j=async()=>{var t,e;try{const a=await w.get("/account/check");b.value=a.data,console.log("현재 사용자 ID:",b.value)}catch(a){console.error("사용자 정보 로드 실패:",a),(((t=a.response)==null?void 0:t.status)===401||!((e=a.response)!=null&&e.data))&&alert("로그인이 필요합니다.")}finally{N.value=!1}},c=o({q1:null,q2:null,q3:null,q4:null,q5:null}),g=o(0),u=o(!1),m=o(""),l=o(1),L=Q(),I=o(E.courseId||L.query.courseId||""),v=o({course_name:"",professor_name:"",credits:"",evaluation_date:""}),h=o(!0),y=o(null),x=[{number:1,question:"수업내용이 체계적으로 구성되었다."},{number:2,question:"교수의 강의 진행 속도가 적절하다."},{number:3,question:"수업 자료(PPT, 교재 등)가 이해하기 쉽게 준비되었다."},{number:4,question:"교수가 학생들의 질문에 성실히 답변해준다."},{number:5,question:"이 강의를 다른 학생들에게 추천하고 싶다."}],M=[{label:"매우 그렇지 않다",value:1},{label:"그렇지 않다",value:2},{label:"보통이다",value:3},{label:"그렇다",value:4},{label:"매우 그렇다",value:5}],P=t=>w.get(`/course/${t}`).catch(e=>e.response),C=async()=>{try{h.value=!0,y.value=null;const t=await P(I.value);if(t&&t.data){const e=t.data;v.value={courseId:e.courseId,title:e.title||e.title||"과목명 정보 없음",credit:e.credit!==void 0?e.credit:"학점 정보 없음",professorName:e.userName||"교수명 정보 없음",type:e.type||"이수구분 정보 없음",classroom:e.classroom||"강의실 정보 없음",year:e.year||"년도 정보 없음",semester:e.semester||"학기 정보 없음",evaluation_date:new Date().toLocaleDateString("ko-KR")}}else throw new Error("강의 정보를 불러올 수 없습니다.")}catch(t){console.error("강의 정보 로드 실패:",t),y.value=t.message||"강의 정보를 불러오는 중 오류가 발생했습니다.",v.value={courseId:null,title:"강의 정보 로드 실패",credit:"정보 없음",professorName:"정보 없음",type:"이수구분 정보 없음",classroom:"정보 없음",year:"정보 없음",semester:"정보 없음",evaluation_date:new Date().toLocaleDateString("ko-KR")}}finally{h.value=!1}},q=()=>{const t=Object.values(c.value).filter(e=>e!==null).length;g.value=Math.round(t/d*100)},R=t=>{c.value["q"+l.value]=t,q()},T=()=>{l.value<d+1&&l.value++},V=()=>{l.value>1&&l.value--},z=async()=>{var t;if(!b.value){alert("사용자 인증이 필요합니다. 다시 로그인해주세요.");return}if(Object.values(c.value).every(e=>e!==null)){const e=Object.values(c.value),a=Math.round(e.reduce((_,K)=>_+K,0)/e.length),k={courseId:parseInt(I.value),userId:b.value,review:m.value,average:a};console.log("설문 결과:",k);try{await w.post("/student/course/survey",k),u.value=!0,alert(`설문이 성공적으로 제출되었습니다!
소중한 의견 감사합니다.`),O.push("/profile")}catch(_){console.error("설문 제출 실패:",_),((t=_.response)==null?void 0:t.status)===401?alert("로그인 세션이 만료되었습니다. 다시 로그인해주세요."):alert("설문 제출에 실패했습니다. 다시 시도해주세요.")}}else alert("모든 필수 항목에 답변해주세요.")},A=()=>{confirm("작성한 내용이 모두 삭제됩니다. 계속하시겠습니까?")&&(Object.keys(c.value).forEach(t=>c.value[t]=null),m.value="",u.value=!1,q(),l.value=1)},B=S(()=>c.value["q"+l.value]!==null),F=S(()=>Object.values(c.value).every(t=>t!==null));return $(async()=>{q(),await Promise.all([j(),C()])}),(t,e)=>(i(),r("div",ee,[e[10]||(e[10]=s("div",{class:"survey-header"},[s("h1",null,"중간강의평가 설문지")],-1)),s("div",se,[e[6]||(e[6]=s("h5",null,"📚 강의 정보",-1)),h.value?(i(),r("div",te,e[1]||(e[1]=[s("div",{class:"spinner"},null,-1),s("p",null,"강의 정보를 불러오는 중...",-1)]))):y.value?(i(),r("div",le,[s("p",ae,"⚠️ "+n(y.value),1),s("button",{onClick:C,class:"btn btn-sm btn-outline-primary"}," 다시 시도 ")])):(i(),r("div",oe,[s("div",ne,[s("p",null,[e[2]||(e[2]=s("strong",null,"과목명:",-1)),f(" "+n(v.value.title),1)]),s("p",null,[e[3]||(e[3]=s("strong",null,"담당교수:",-1)),f(" "+n(v.value.professorName),1)])]),s("div",ue,[s("p",null,[e[4]||(e[4]=s("strong",null,"학점:",-1)),f(" "+n(v.value.credit)+"학점",1)]),s("p",null,[e[5]||(e[5]=s("strong",null,"이수구분:",-1)),f(" "+n(v.value.type),1)])])]))]),s("div",re,[s("div",{class:"progress-bar",role:"progressbar",style:H({width:g.value+"%"})},null,4)]),s("p",ie," 진행률: "+n(g.value)+"% ("+n(l.value)+"/"+n(d+1)+"단계) ",1),s("form",{onSubmit:Z(z,["prevent"]),class:Y({"form-disabled":u.value})},[l.value<=d?(i(),r("div",ce,[s("div",de,[s("div",ve,n(x[l.value-1].number),1),s("div",pe,n(x[l.value-1].question),1)]),s("div",be,[s("div",me,[(i(),r(J,null,X(M,a=>s("div",{key:a.value,class:"rating-option"},[s("div",ye,n(a.label),1),s("div",_e,[s("input",{class:"rating-input",type:"radio",name:"q"+l.value,id:"q"+l.value+"_"+a.value,value:a.value,"data-value":a.value,onInput:k=>R(a.value),checked:c.value["q"+l.value]==a.value,disabled:u.value},null,40,fe)])])),64))])])])):p("",!0),l.value===d+1?(i(),r("div",ge,[e[7]||(e[7]=s("div",{class:"question-header"},[s("div",{class:"question-number"},"💬"),s("div",{class:"question-text"}," 강의에 대한 추가 의견이나 개선사항이 있다면 자유롭게 작성해주세요. ")],-1)),s("div",he,[G(s("textarea",{class:"form-control opinion-textarea",rows:"6",placeholder:"강의 개선을 위한 의견을 자유롭게 작성해주세요...","onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),disabled:u.value},null,8,qe),[[W,m.value]])])])):p("",!0),s("div",ke,[s("button",{type:"button",class:"btn btn-outline-secondary btn-lg me-3",onClick:V,disabled:l.value===1||u.value}," ← 이전 ",8,we),l.value<=d?(i(),r("button",{key:0,type:"button",class:"btn btn-primary btn-lg",onClick:T,disabled:!B.value||u.value}," 다음 → ",8,Ie)):p("",!0),l.value===d+1?(i(),r("button",{key:1,type:"submit",class:"btn btn-success btn-lg",disabled:u.value||!F.value}," 📝 설문 제출 ",8,xe)):p("",!0),s("button",{type:"button",class:"btn btn-outline-secondary btn-lg ms-3",onClick:A,disabled:u.value}," 🔄 다시 작성 ",8,Ce),e[8]||(e[8]=s("p",{class:"text-muted mt-3 mb-0"}," 익명으로 제출되며, 강의 개선에 소중한 자료로 활용됩니다. ",-1))]),u.value?(i(),r("div",Se,e[9]||(e[9]=[s("h4",null,"🎉 제출 완료!",-1),s("p",null," 설문에 참여해주셔서 감사합니다. 더 나은 강의를 위해 소중한 의견을 반영하겠습니다. ",-1)]))):p("",!0)],34)]))}};export{Ne as default};
