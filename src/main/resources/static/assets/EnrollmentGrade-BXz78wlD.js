import{_ as N,z as F,a as _,r as D,k as A,P as w,q as B,c,o as m,b as e,g as r,v as p,H as u,N as U,F as $,E as M}from"./index-BYEgPVgA.js";const q={class:"wrap"},L={class:"box"},R={class:"toolbar"},j={class:"left"},O={class:"right"},P={class:"search"},J=["disabled"],G={key:0,class:"state"},Y={key:1,class:"state error"},z={key:2,class:"table-scroll"},H={key:0,class:"tbl"},T={style:{width:"44px"}},W=["onUpdate:modelValue"],K={class:"left-cell"},Q=["onUpdate:modelValue"],X=["onUpdate:modelValue"],Z=["onUpdate:modelValue","onInput"],tt=["onUpdate:modelValue","onInput"],et=["onUpdate:modelValue","onInput"],nt=["onUpdate:modelValue","onInput"],st={key:1,class:"state"},at={__name:"EnrollmentGrade",setup(lt){F();const f={att:.1,mid:.3,fin:.4,etc:.2},l=_({q:"",allChecked:!1,courseId:"",rows:[],loading:!0,error:""}),y=D(!1),S=a=>Number.isFinite(+a)?+a:0,v=a=>Math.min(100,Math.max(0,S(a))),b=a=>{a.attendanceEval=v(a.attendanceEval),a.midterm=v(a.midterm),a.finalExam=v(a.finalExam),a.etcScore=v(a.etcScore);const t=a.attendanceEval*f.att+a.midterm*f.mid+a.finalExam*f.fin+a.etcScore*f.etc;a.total=t,a.grade=t>=95?"A+":t>=90?"A":t>=85?"B+":t>=80?"B":t>=75?"C+":t>=70?"C":t>=60?"D":"F",a.gpa={"A+":4.5,A:4,"B+":3.5,B:3,"C+":2.5,C:2,D:1,F:0}[a.grade]};A(async()=>{var a,t;try{const n=(a=history.state)==null?void 0:a.id,o=(t=history.state)==null?void 0:t.data;if(n&&(l.courseId=JSON.parse(n)),o){const i=JSON.parse(o);l.rows=i.map(s=>({...s,attendanceDays:s.attendanceDays??0,absence:s.absence??0,attendanceEval:s.attendanceEval??0,midterm:s.midterm??0,finalExam:s.finalExam??0,etcScore:s.etcScore??s.assignment??0,total:0,grade:"",gpa:0,checked:!1}))}if(l.courseId)try{const{data:i}=await w.get(`/api/professor/course/grade/students?courseId=${l.courseId}`);Array.isArray(i)&&(l.rows=i.map(s=>({...s,attendanceDays:s.attendanceDays??0,absence:s.absence??0,attendanceEval:s.attendanceEval??0,midterm:s.midterm??0,finalExam:s.finalExam??0,etcScore:s.etcScore??s.assignment??0,total:0,grade:"",gpa:0,checked:!1})),console.log("학생 데이터 로드됨:",l.rows))}catch(i){console.error("학생 목록 API 오류:",i)}l.rows.forEach(b)}catch(n){l.error="학생 목록을 불러오지 못했습니다.",console.error(n)}finally{l.loading=!1}});const g=B(()=>{const a=l.q.trim();return a?l.rows.filter(t=>String(t.loginId??"").includes(a)||String(t.userName??"").includes(a)):l.rows}),x=()=>g.value.forEach(a=>a.checked=l.allChecked);async function C(){var t,n,o,i;const a=l.rows.filter(s=>s.checked);if(a.length===0){alert("수정할 학생을 선택하세요.");return}y.value=!0;try{const s=[],d=[];for(const h of a){const k=Math.round(Number(h.midterm)??0),E=Math.round(Number(h.finalExam)??0),I=h.grade??"F";h.scoreId?d.push({scoreId:h.scoreId,midScore:k,finScore:E,rank:I}):s.push({enrollmentId:h.enrollmentId,midScore:k,finScore:E,rank:I})}s.length&&await w.post("/professor/course/grade",s),d.length&&await w.put("/professor/course/grade",d),alert("선택한 학생 성적이 저장되었습니다!")}catch(s){console.error("[성적 저장 실패]",(t=s==null?void 0:s.response)==null?void 0:t.status,(n=s==null?void 0:s.response)==null?void 0:n.data),alert(`성적 저장 중 오류: ${((i=(o=s==null?void 0:s.response)==null?void 0:o.data)==null?void 0:i.message)??""}`)}finally{y.value=!1}}function V(){const a=["학번","이름","학년","학과","출석일수","결석일수","출결평가","중간평가","기말평가","기타평가","총점","등급","평점"],t=l.rows.map(d=>[d.loginId??"",d.userName??"",d.gradeYear??d.grade??"",d.departmentName??"",d.attendanceDays??0,d.absence??0,d.attendanceEval??0,d.midterm??0,d.finalExam??0,d.etcScore??0,d.total??0,d.grade??"",d.gpa??0]),n="\uFEFF"+[a,...t].map(d=>d.join(",")).join(`
`),o=new Blob([n],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(o),s=document.createElement("a");s.href=i,s.download=`grades_${l.courseId}.csv`,s.click(),URL.revokeObjectURL(i)}return(a,t)=>(m(),c("div",q,[e("div",L,[t[20]||(t[20]=e("h1",{class:"page-title"},"성적 관리",-1)),t[21]||(t[21]=e("h3",{class:"subtitle"},"컴퓨터 과학개론 성적 입력 및 정정",-1)),e("div",R,[e("div",j,[e("button",{class:"btn btn-light",onClick:t[0]||(t[0]=n=>{l.allChecked=!l.allChecked,x()})}," 전체선택 "),e("button",{class:"btn btn-light",onClick:V},"내보내기")]),e("div",O,[e("div",P,[t[3]||(t[3]=e("span",{class:"icon"},"🔍",-1)),r(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>l.q=n),placeholder:"이름 또는 학번 검색"},null,512),[[p,l.q]])]),e("button",{class:"btn btn-primary",disabled:y.value,onClick:C},u(y.value?"저장 중...":"선택 저장"),9,J)])]),l.loading?(m(),c("div",G,"불러오는 중…")):l.error?(m(),c("div",Y,u(l.error),1)):(m(),c("div",z,[g.value.length?(m(),c("table",H,[e("thead",null,[e("tr",null,[e("th",T,[r(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=n=>l.allChecked=n),onChange:x},null,544),[[U,l.allChecked]])]),t[4]||(t[4]=e("th",{style:{width:"100px"}},"학번",-1)),t[5]||(t[5]=e("th",{style:{width:"90px"}},"이름",-1)),t[6]||(t[6]=e("th",{style:{width:"80px"}},"학년",-1)),t[7]||(t[7]=e("th",{style:{width:"160px"}},"학과",-1)),t[8]||(t[8]=e("th",{style:{width:"92px"}},"출석일수",-1)),t[9]||(t[9]=e("th",{style:{width:"92px"}},"결석일수",-1)),t[10]||(t[10]=e("th",{style:{width:"92px"}},"출결평가",-1)),t[11]||(t[11]=e("th",{style:{width:"92px"}},"중간평가",-1)),t[12]||(t[12]=e("th",{style:{width:"92px"}},"기말평가",-1)),t[13]||(t[13]=e("th",{style:{width:"92px"}},"기타평가",-1)),t[14]||(t[14]=e("th",{style:{width:"80px"}},"원점수",-1)),t[15]||(t[15]=e("th",{style:{width:"86px"}},"환산점수",-1)),t[16]||(t[16]=e("th",{style:{width:"70px"}},"등급",-1)),t[17]||(t[17]=e("th",{style:{width:"70px"}},"평점",-1)),t[18]||(t[18]=e("th",{style:{width:"76px"}},"수정",-1))])]),e("tbody",null,[(m(!0),c($,null,M(g.value,n=>(m(),c("tr",{key:n.enrollmentId},[e("td",null,[r(e("input",{type:"checkbox","onUpdate:modelValue":o=>n.checked=o},null,8,W),[[U,n.checked]])]),e("td",null,u(n.loginId),1),e("td",null,u(n.userName),1),e("td",null,u(n.gradeYear),1),e("td",K,u(n.departmentName),1),e("td",null,[r(e("input",{class:"num",type:"number",min:"0","onUpdate:modelValue":o=>n.attendanceDays=o},null,8,Q),[[p,n.attendanceDays,void 0,{number:!0}]])]),e("td",null,[r(e("input",{class:"num",type:"number",min:"0","onUpdate:modelValue":o=>n.absence=o},null,8,X),[[p,n.absence,void 0,{number:!0}]])]),e("td",null,[r(e("input",{class:"num",type:"number",min:"0",max:"100","onUpdate:modelValue":o=>n.attendanceEval=o,onInput:o=>b(n)},null,40,Z),[[p,n.attendanceEval,void 0,{number:!0}]])]),e("td",null,[r(e("input",{class:"num",type:"number",min:"0",max:"100","onUpdate:modelValue":o=>n.midterm=o,onInput:o=>b(n)},null,40,tt),[[p,n.midterm,void 0,{number:!0}]])]),e("td",null,[r(e("input",{class:"num",type:"number",min:"0",max:"100","onUpdate:modelValue":o=>n.finalExam=o,onInput:o=>b(n)},null,40,et),[[p,n.finalExam,void 0,{number:!0}]])]),e("td",null,[r(e("input",{class:"num",type:"number",min:"0",max:"100","onUpdate:modelValue":o=>n.etcScore=o,onInput:o=>b(n)},null,40,nt),[[p,n.etcScore,void 0,{number:!0}]])]),e("td",null,u(n.total.toFixed(1)),1),e("td",null,u(n.total.toFixed(1)),1),e("td",null,u(n.grade),1),e("td",null,u(n.gpa.toFixed(1)),1),t[19]||(t[19]=e("td",null,[e("button",{class:"btn btn-gray w-full"},"수정")],-1))]))),128))])])):(m(),c("div",st,"표시할 학생이 없습니다."))]))])]))}},dt=N(at,[["__scopeId","data-v-da7241e9"]]);export{dt as default};
