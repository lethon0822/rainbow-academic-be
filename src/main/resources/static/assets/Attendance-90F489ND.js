import{_ as j,u as z,z as B,r as d,a as F,k as D,q as E,d as O,o as m,h as A,b as e,g as i,N as x,v as w,M as q,H as u,c as g,F as V,E as I,J as f,f as $,O as T,P as _}from"./index-BYEgPVgA.js";import{c as W}from"./professorService-CXZIKLuV.js";import{W as H}from"./WhiteBox-2PWihVXJ.js";/* empty css                                                                 */const J={class:"att-wrap"},P={class:"toolbar"},Y={class:"left"},G={class:"chk-all"},K={class:"date"},Q={class:"right"},X=["disabled"],Z={class:"table-scroll"},ee={class:"tbl"},te={style:{width:"40px"}},le=["onUpdate:modelValue"],ae={class:"left-cell"},se={class:"att-selector"},oe=["name","value","onUpdate:modelValue"],ne={class:"label"},ie=["onUpdate:modelValue"],ue={__name:"Attendance",setup(ce){const C=z(),N=B(),c=d(new Date().toISOString().slice(0,10)),h=d(""),p=d("전체"),r=d(!1),b=d(!1),n=F({data:[],courseId:N.query.id}),S=[{value:"출석",label:"출석",icon:"bi bi-check-circle-fill",cls:"success"},{value:"지각",label:"지각",icon:"bi bi bi-alarm-fill",cls:"warning"},{value:"결석",label:"결석",icon:"bi bi-x-circle-fill",cls:"danger"},{value:"병가",label:"병가",icon:"bi bi-emoji-dizzy-fill",cls:"info"},{value:"경조사",label:"경조사",icon:"bi bi-flower1",cls:"neutral"}],y=a=>{switch(a){case"출석":return{label:"출석",cls:"success",icon:"bi bi-check-circle-fill"};case"결석":return{label:"결석",cls:"danger",icon:"bi bi-x-circle-fill"};case"지각":return{label:"지각",cls:"warning",icon:"bi bi-alarm-fill"};case"병가":return{label:"병가",cls:"info",icon:"bi bi-emoji-dizzy-fill"};case"경조사":return{label:"경조사",cls:"neutral",icon:"bi bi-flower1"};default:return{label:a||"미지정",cls:"neutral",icon:"bi bi-question-circle"}}};D(async()=>{const a=await W(n.courseId);console.log("알이에쓰:",a),n.data=a.data,n.data=a.data.map(t=>({...t,checked:!1,status:t.status??"결석",note:t.note??""}))});const L=E(()=>{const a=h.value.trim();return n.data.filter(t=>{const l=!a||String(t.userName??"").includes(a)||String(t.loginId??"").includes(a),s=p.value==="전체"||t.status===p.value;return l&&s})}),U=()=>L.value.forEach(a=>a.checked=r.value),M=async()=>{if(!c.value){alert("출결일자를 선택해주세요.");return}b.value=!0;try{for(const a of n.data){const t={attendDate:c.value,enrollmentId:a.enrollmentId,status:a.status,note:a.note},{data:l}=await _.post("/professor/course/check/exist",t);l===0?await _.post("/professor/course/check",t):await _.put("/professor/course/check",t)}alert("출결 저장 완료!"),await C.push("/professor/attendance")}catch(a){console.error("출결 저장 중 오류:",a),alert("출결 저장 중 오류가 발생했습니다.")}finally{b.value=!1}},R=()=>{const a=["학번","이름","학년","학과","출결상태","비고","학기","일자"],t=n.data.map(o=>[o.loginId??"",o.userName??"",o.gradeYear??o.grade??"",o.departmentName??"",o.status??"",o.note??"",o.semester??"",c.value]),l="\uFEFF"+[a,...t].map(o=>o.join(",")).join(`
`),s=new Blob([l],{type:"text/csv;charset=utf-8;"}),v=URL.createObjectURL(s),k=document.createElement("a");k.href=v,k.download=`attendance_${n.courseId}_${c.value}.csv`,k.click(),URL.revokeObjectURL(v)};return(a,t)=>(m(),O(H,{title:"출결 관리",class:"full-width"},{default:A(()=>[e("div",J,[t[14]||(t[14]=e("h3",{class:"page-subtitle"},"컴퓨터 과학개론 출석부",-1)),e("div",P,[e("div",Y,[e("label",G,[i(e("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=l=>r.value=l),onChange:U},null,544),[[x,r.value]]),t[5]||(t[5]=e("span",null,"전체선택",-1))]),e("button",{class:"btn btn-light",onClick:R},"내보내기"),e("div",K,[i(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=l=>c.value=l)},null,512),[[w,c.value]])])]),e("div",Q,[i(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>h.value=l),class:"search",type:"text",placeholder:"이름 또는 학번 검색","aria-label":"검색"},null,512),[[w,h.value]]),i(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>p.value=l),class:"filter"},t[6]||(t[6]=[e("option",{value:"전체"},"상태/전체",-1),e("option",{value:"출석"},"출석",-1),e("option",{value:"결석"},"결석",-1),e("option",{value:"지각"},"지각",-1),e("option",{value:"병가"},"병가",-1),e("option",{value:"경조사"},"경조사",-1)]),512),[[q,p.value]]),e("button",{class:"btn btn-primary",disabled:b.value,onClick:M},u(b.value?"저장 중...":"저장"),9,X)])]),e("div",Z,[e("table",ee,[e("thead",null,[e("tr",null,[e("th",te,[i(e("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=l=>r.value=l),onChange:U},null,544),[[x,r.value]])]),t[7]||(t[7]=e("th",{style:{width:"30px"}},"학번",-1)),t[8]||(t[8]=e("th",{style:{width:"30px"}},"이름",-1)),t[9]||(t[9]=e("th",{style:{width:"30px"}},"학년",-1)),t[10]||(t[10]=e("th",{style:{width:"50px"}},"학과",-1)),t[11]||(t[11]=e("th",{style:{width:"50px"}},"출결상태",-1)),t[12]||(t[12]=e("th",{style:{width:"90px"}},"상태 변경",-1)),t[13]||(t[13]=e("th",{style:{width:"100px"}},"비고",-1))])]),e("tbody",null,[(m(!0),g(V,null,I(n.data,l=>(m(),g("tr",{key:l.enrollmentId},[e("td",null,[i(e("input",{type:"checkbox","onUpdate:modelValue":s=>l.checked=s},null,8,le),[[x,l.checked]])]),e("td",null,u(l.loginId),1),e("td",null,u(l.userName),1),e("td",null,u(l.grade),1),e("td",ae,u(l.deptName),1),e("td",null,[e("span",{class:f(["att-badge",y(l.status).cls])},[e("i",{class:f(y(l.status).icon)},null,2),$(" "+u(y(l.status).label),1)],2)]),e("td",null,[e("div",se,[(m(),g(V,null,I(S,s=>e("label",{key:s.value,class:f(["att-option",{selected:l.status===s.value}])},[i(e("input",{type:"radio",name:`status-${l.enrollmentId}`,value:s.value,"onUpdate:modelValue":v=>l.status=v},null,8,oe),[[T,l.status]]),e("i",{class:f(s.icon)},null,2),e("span",ne,u(s.label),1)],2)),64))])]),e("td",null,[i(e("input",{type:"text","onUpdate:modelValue":s=>l.note=s,class:"note",placeholder:"비고 입력"},null,8,ie),[[w,l.note]])])]))),128))])])])])]),_:1}))}},ve=j(ue,[["__scopeId","data-v-3240b18c"]]);export{ve as default};
