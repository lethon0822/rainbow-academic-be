import{Y as C,_,b as v,d as k,k as h,t as z,c as m,o as p,a as e,r as x,f,H as d,g as I,N as y,F as D,A,C as b}from"./index-D6WQuHd6.js";import{g as P,a as T}from"./GradeService-DQsg0w3b.js";import B from"./StudentRecordTab-DOR8PY71.js";const R=C("user",{state:()=>({login_id:"",user_name:"",email:"",user_role:"",status:"",grade:"",semester:"",year:"",dept_name:"",totalcredits:0}),actions:{setUserInfo(t){this.login_id=t.login_id||"",this.user_name=t.user_name||"",this.email=t.email||"",this.user_role=t.user_role||"",this.status=t.status||"",this.grade=t.grade||"",this.semester=t.semester||"",this.year=t.year||"",this.dept_name=t.dept_name||"",this.totalcredits=t.totalcredits||0},clearUserInfo(){this.login_id="",this.user_name="",this.email="",this.user_role="",this.status="",this.grade="",this.semester="",this.year="",this.dept_name="",this.totalcredits=0}},getters:{userId:t=>t.login_id,userName:t=>t.user_name,userRole:t=>t.user_role},persist:!0}),U={class:"inner"},E={class:"header-section"},G={class:"action-buttons"},H={class:"profile-container"},L={class:"image-box"},Y={class:"profile-image"},Z={class:"avatar-wrapper"},V={class:"avatar"},W=["src"],$={key:1,class:"avatar-icon",fill:"#6c757d",viewBox:"0 0 24 24"},F={class:"info-box"},Q={class:"profile-info"},J={class:"left-info"},K={class:"value-cell"},O={class:"value-cell"},X={class:"value-cell"},q={class:"value-cell"},ee={class:"value-cell"},le={class:"value-cell"},te={class:"right-info"},se={class:"value-cell",colspan:"2"},ae={class:"value-cell"},oe={class:"value-cell"},ie={class:"value-cell",colspan:"2"},ne={class:"value-cell",colspan:"2"},re={class:"value-cell",colspan:"2"},de={__name:"Profile",props:{profile:{type:Object,default:()=>({})}},setup(t){const i=t,n=v(null),s=v(null),c=v(null),a=v(null),u=k({studentType:"대학생",department:"선택"}),g=()=>{const o=`profileImage_${i.profile.loginId}`,l=sessionStorage.getItem(o);l?a.value=l:i.profile.loginId==="20220001"&&(a.value="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiBmaWxsPSIjRjBGMEYwIi8+CjxjaXJjbGUgY3g9IjYwIiBjeT0iNDAiIHI9IjE2IiBmaWxsPSIjNkM3NTdEIi8+CjxwYXRoIGQ9Ik0zMCA4MEMzMCA3MS4xNjM0IDQ0LjUzNjYgNjQgNjAgNjRDNzUuNDYzNCA2NCA5MCA3MS4xNjM0IDkwIDgwVjEwMEgzMFY4MFoiIGZpbGw9IiM2Qzc1N0QiLz4KPC9zdmc+")};h(()=>{i.profile.loginId&&g()}),z(()=>i.profile.loginId,o=>{o&&(n.value=null,s.value=null,a.value=null,g())});const M=o=>{const l=o.target.files[0];if(l){if(l.size>5*1024*1024){alert("파일 크기는 5MB 이하여야 합니다.");return}if(!l.type.startsWith("image/")){alert("이미지 파일만 업로드 가능합니다.");return}n.value=l;const r=new FileReader;r.onload=S=>{s.value=S.target.result},r.readAsDataURL(l)}},w=()=>{c.value.click()},N=()=>{n.value=null,s.value=null,c.value.value="";const o=`profileImage_${i.profile.loginId}`;sessionStorage.removeItem(o),a.value=null},j=async()=>{try{if(await new Promise(r=>setTimeout(r,500)),n.value&&s.value){const r=`profileImage_${i.profile.loginId}`;sessionStorage.setItem(r,s.value),a.value=s.value}const o={userId:i.profile.loginId,studentType:u.studentType,department:u.department};(await fetch("/api/profile/update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify(o)})).ok,alert(`프로필이 성공적으로 업데이트되었습니다.
(이미지는 세션 동안만 유지됩니다)`),n.value=null,s.value=null}catch(o){console.error("프로필 업데이트 오류:",o),alert("프로필 업데이트 중 오류가 발생했습니다.")}};return(o,l)=>(p(),m(D,null,[e("div",U,[e("div",E,[l[2]||(l[2]=e("h2",{class:"title"},"학적기본사항관리",-1)),e("div",G,[s.value?(p(),m("button",{key:0,class:"btn btn-primary",onClick:j}," 저장 ")):f("",!0),s.value||a.value?(p(),m("button",{key:1,class:"btn btn-secondary",onClick:N}," 이미지 제거 ")):f("",!0)])]),l[3]||(l[3]=e("div",{class:"line"},null,-1)),x(o.$slots,"default",{},void 0,!0)]),e("div",H,[e("div",L,[e("div",Y,[e("div",Z,[e("div",V,[s.value||a.value?(p(),m("img",{key:0,src:s.value||a.value,alt:"프로필 이미지",class:"profile-img"},null,8,W)):(p(),m("svg",$,l[4]||(l[4]=[e("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"},null,-1)])))]),e("div",{class:"camera-icon",onClick:w},l[5]||(l[5]=[e("svg",{width:"30",height:"30",fill:"white",viewBox:"0 0 24 24"},[e("path",{d:"M12 15.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5zM9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5z"})],-1)]))]),e("input",{ref_key:"fileInput",ref:c,type:"file",accept:"image/*",onChange:M,style:{display:"none"}},null,544)])]),e("div",F,[e("div",Q,[e("div",J,[e("table",null,[e("tbody",null,[e("tr",null,[l[6]||(l[6]=e("td",{class:"label-cell"},"학번",-1)),e("td",K,d(t.profile.loginId),1)]),e("tr",null,[l[7]||(l[7]=e("td",{class:"label-cell"},"성명(한글)",-1)),e("td",O,d(t.profile.studentName),1)]),e("tr",null,[l[8]||(l[8]=e("td",{class:"label-cell"},"E-mail",-1)),e("td",X,d(t.profile.email),1)]),e("tr",null,[l[10]||(l[10]=e("td",{class:"label-cell"},"학생구분",-1)),e("td",q,[I(e("select",{"onUpdate:modelValue":l[0]||(l[0]=r=>u.studentType=r)},l[9]||(l[9]=[e("option",null,"대학생",-1),e("option",null,"대학원생",-1)]),512),[[y,u.studentType]])])]),e("tr",null,[l[11]||(l[11]=e("td",{class:"label-cell"},"최종등록연도",-1)),e("td",ee,d(t.profile.year),1)]),e("tr",null,[l[12]||(l[12]=e("td",{class:"label-cell"},"학적상태",-1)),e("td",le,d(t.profile.status),1)])])])]),e("div",te,[e("table",null,[e("tr",null,[l[13]||(l[13]=e("td",{class:"label-cell"},"학년",-1)),e("td",se,d(t.profile.grade),1)]),e("tr",null,[l[15]||(l[15]=e("td",{class:"label-cell",rowspan:"2"},"소속",-1)),l[16]||(l[16]=e("td",{class:"label-cell"},"학부(과)",-1)),e("td",ae,[I(e("select",{"onUpdate:modelValue":l[1]||(l[1]=r=>u.department=r)},l[14]||(l[14]=[e("option",null,"선택",-1),e("option",null,"자연융합학부",-1),e("option",null,"공학시스템학부",-1)]),512),[[y,u.department]])])]),e("tr",null,[l[17]||(l[17]=e("td",{class:"label-cell"},"전공",-1)),e("td",oe,d(t.profile.deptName),1)]),e("tr",null,[l[18]||(l[18]=e("td",{class:"label-cell"},"담당교수",-1)),e("td",ie,d(t.profile.professorName),1)]),e("tr",null,[l[19]||(l[19]=e("td",{class:"label-cell"},"학기",-1)),e("td",ne,d(t.profile.semester),1)]),e("tr",null,[l[20]||(l[20]=e("td",{class:"label-cell"},"졸업충족학점",-1)),e("td",re,d(t.profile.totalCredits)+"(이수) / 140(총) ",1)])])])])])])],64))}},ue=_(de,[["__scopeId","data-v-fd45ab76"]]),ce={class:"content"},me={__name:"StudentRecord",setup(t){const i=A();R(),console.log("로그인 상태:",i.state.checked),console.log("로그인 아이디:",i.state.loggedIn);const n=v({}),s=v([]);return h(async()=>{var c;try{const a=await P();s.value=a.data||[];const u=await T();n.value=u.data||{},console.log("프로필 데이터:",n.value)}catch(a){console.error("에러:",a),((c=a.response)==null?void 0:c.status)===401&&console.log("로그인이 필요합니다")}}),(c,a)=>(p(),m("div",ce,[b(ue,{profile:n.value},null,8,["profile"]),b(B,{grades:s.value,profile:n.value},null,8,["grades","profile"])]))}},fe=_(me,[["__scopeId","data-v-dda7542c"]]);export{fe as default};
