import{O as g,_ as I,b as u,s as m,m as L,Q as C,R as b,T as R,e as B,o as N,i as E,D as d,a as n,I as p,W as k,S as D}from"./index-DOBXMv_I.js";import{S as F,_ as f}from"./CourseTable-CU75-2UF.js";const H=l=>g.post("/student/sugang",l),M=l=>g.delete(`/student/sugang/${l}`),V={class:"creditInfo d-flex mt-5 mb-0.3rem ms-3"},W={class:"credit-box"},$={__name:"Enrollment",setup(l){const i=u([]),v=u([]),s=u([]),r=u([]),_=m(()=>r.value.reduce((a,e)=>a+e.credit,0)),h=m(()=>r.value.length);L(async()=>{const a=await C();i.value=a.data;const e=await b();v.value=e.data;const t=await R();r.value=t.data});const x=async a=>{const e=await D(a);s.value=e.data.map(t=>(t.enrolled=r.value.some(o=>o.courseId===t.courseId),t))},S=async a=>{const e={courseId:a.courseId};if(confirm("수강신청을 하시겠습니까?"))try{const t=await H(e);if(t.status===200){const o=t.data,c=s.value.findIndex(w=>w.courseId===o.courseId);c!==-1&&(s.value[c].remStd=o.remStd,s.value[c].enrolled=!0),r.value.push(o),alert("수강신청이 완료되었습니다.")}}catch(t){switch(t.response.data.code){case 4002:alert("정원 초과! 수강신청에 실패하였습니다.");break;case 5001:alert("서버 오류! 수강신청에 실패하였습니다.");break;default:alert("오류가 발생하였습니다.")}}},y=async a=>{if(confirm("수강신청을 취소하시겠습니까?"))try{await M(a),r.value=r.value.filter(t=>t.courseId!==a);const e=s.value.findIndex(t=>t.courseId===a);e!==-1&&(s.value[e].enrolled=!1,s.value[e].remStd+=1),alert("수강신청이 취소되었습니다.")}catch(e){alert("오류가 발생하였습니다. 현재 이 강의는 출석테이블이랑 연동되어 있어서 수강취소가 안 됨. db 수정필요"),console.error(e)}};return(a,e)=>(N(),B(k,{title:"수강 신청"},{default:E(()=>[d(F,{state:!0,departments:i.value,enrollment:!0,semester:1,onSearch:x},null,8,["departments"]),e[2]||(e[2]=n("h5",{class:"fw-bold mt-3 ms-3"},"개설 과목 목록",-1)),d(f,{courseList:s.value,maxHeight:"500px",show:{professorName:!0,remStd:!0,enroll:!0,cancel:!1,deptName:!0},onEnroll:S},null,8,["courseList"]),n("div",V,[e[1]||(e[1]=n("h5",{class:"fw-bold"},"신청 내역",-1)),n("div",W,[e[0]||(e[0]=n("span",null,"최대 학점: 18학점",-1)),n("span",null,"신청 학점: "+p(_.value)+"학점",1),n("span",null,"신청 과목 수: "+p(h.value)+"개",1)])]),d(f,{courseList:r.value,maxHeight:"500px",show:{professorName:!0,remStd:!0,enroll:!1,cancel:!0,deptName:!1},onCancel:y},null,8,["courseList"])]),_:1,__:[2]}))}},Q=I($,[["__scopeId","data-v-260e541f"]]);export{Q as default};
