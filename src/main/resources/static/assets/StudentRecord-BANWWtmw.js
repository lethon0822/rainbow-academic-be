import{X as j,_ as y,b as p,d as S,m as h,x as C,c as m,o as v,a as e,r as x,f,I as r,h as z,N as D,F as k,B as A,D as I}from"./index-COq8Ttir.js";import{g as P,a as B}from"./GradeService-B2vmcniM.js";import R from"./StudentRecordTab-Dh3rzFr6.js";const T=j("user",{state:()=>({login_id:"",user_name:"",email:"",user_role:"",status:"",grade:"",semester:"",year:"",dept_name:"",totalcredits:0}),actions:{setUserInfo(t){this.login_id=t.login_id||"",this.user_name=t.user_name||"",this.email=t.email||"",this.user_role=t.user_role||"",this.status=t.status||"",this.grade=t.grade||"",this.semester=t.semester||"",this.year=t.year||"",this.dept_name=t.dept_name||"",this.totalcredits=t.totalcredits||0},clearUserInfo(){this.login_id="",this.user_name="",this.email="",this.user_role="",this.status="",this.grade="",this.semester="",this.year="",this.dept_name="",this.totalcredits=0}},getters:{userId:t=>t.login_id,userName:t=>t.user_name,userRole:t=>t.user_role},persist:!0}),E={class:"inner"},G={class:"header-section"},U={class:"action-buttons"},H={class:"profile-container"},L={class:"image-box"},Z={class:"profile-image"},W={class:"avatar-wrapper"},Y={class:"avatar"},$=["src"],F={key:1,class:"avatar-icon",fill:"#6c757d",viewBox:"0 0 24 24"},Q={class:"info-box"},V={class:"profile-info"},J={class:"left-info"},K={class:"value-cell"},O={class:"value-cell"},X={class:"value-cell"},q={class:"value-cell"},ee={class:"value-cell"},le={class:"right-info"},te={class:"value-cell",colspan:"2"},se={class:"value-cell"},ae={class:"value-cell"},oe={class:"value-cell",colspan:"2"},ie={class:"value-cell",colspan:"2"},ne={class:"value-cell",colspan:"2"},re={__name:"Profile",props:{profile:{type:Object,default:()=>({})}},setup(t){const i=t,n=p(null),a=p(null),c=p(null),s=p(null),u=S({studentType:"대학생",department:"선택"}),g=()=>{const o=`profileImage_${i.profile.loginId}`,l=sessionStorage.getItem(o);l?s.value=l:i.profile.loginId==="20220001"&&(s.value="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiBmaWxsPSIjRjBGMEYwIi8+CjxjaXJjbGUgY3g9IjYwIiBjeT0iNDAiIHI9IjE2IiBmaWxsPSIjNkM3NTdEIi8+CjxwYXRoIGQ9Ik0zMCA4MEMzMCA3MS4xNjM0IDQ0LjUzNjYgNjQgNjAgNjRDNzUuNDYzNCA2NCA5MCA3MS4xNjM0IDkwIDgwVjEwMEgzMFY4MFoiIGZpbGw9IiM2Qzc1N0QiLz4KPC9zdmc+")};h(()=>{i.profile.loginId&&g()}),C(()=>i.profile.loginId,o=>{o&&(n.value=null,a.value=null,s.value=null,g())});const _=o=>{const l=o.target.files[0];if(l){if(l.size>5*1024*1024){alert("파일 크기는 5MB 이하여야 합니다.");return}if(!l.type.startsWith("image/")){alert("이미지 파일만 업로드 가능합니다.");return}n.value=l;const d=new FileReader;d.onload=N=>{a.value=N.target.result},d.readAsDataURL(l)}},b=()=>{c.value.click()},M=()=>{n.value=null,a.value=null,c.value.value="";const o=`profileImage_${i.profile.loginId}`;sessionStorage.removeItem(o),s.value=null},w=async()=>{try{if(await new Promise(d=>setTimeout(d,500)),n.value&&a.value){const d=`profileImage_${i.profile.loginId}`;sessionStorage.setItem(d,a.value),s.value=a.value}const o={userId:i.profile.loginId,studentType:u.studentType,department:u.department};(await fetch("/api/profile/update",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify(o)})).ok,alert(`프로필이 성공적으로 업데이트되었습니다.
(이미지는 세션 동안만 유지됩니다)`),n.value=null,a.value=null}catch(o){console.error("프로필 업데이트 오류:",o),alert("프로필 업데이트 중 오류가 발생했습니다.")}};return(o,l)=>(v(),m(k,null,[e("div",E,[e("div",G,[l[1]||(l[1]=e("h2",{class:"title"},"학적기본사항관리",-1)),e("div",U,[a.value||s.value?(v(),m("button",{key:0,class:"btn btn-primary",onClick:w}," 저장 ")):f("",!0),a.value||s.value?(v(),m("button",{key:1,class:"btn btn-secondary",onClick:M}," 이미지 제거 ")):f("",!0)])]),l[2]||(l[2]=e("div",{class:"line"},null,-1)),x(o.$slots,"default",{},void 0,!0)]),e("div",H,[e("div",L,[e("div",Z,[e("div",W,[e("div",Y,[a.value||s.value?(v(),m("img",{key:0,src:a.value||s.value,alt:"프로필 이미지",class:"profile-img"},null,8,$)):(v(),m("svg",F,l[3]||(l[3]=[e("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"},null,-1)])))]),e("div",{class:"camera-icon",onClick:b},l[4]||(l[4]=[e("svg",{width:"30",height:"30",fill:"white",viewBox:"0 0 24 24"},[e("path",{d:"M12 15.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5zM9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5z"})],-1)]))]),e("input",{ref_key:"fileInput",ref:c,type:"file",accept:"image/*",onChange:_,style:{display:"none"}},null,544)])]),e("div",Q,[e("div",V,[e("div",J,[e("table",null,[e("tbody",null,[e("tr",null,[l[5]||(l[5]=e("td",{class:"label-cell"},"학번",-1)),e("td",K,r(t.profile.loginId),1)]),e("tr",null,[l[6]||(l[6]=e("td",{class:"label-cell"},"성명(한글)",-1)),e("td",O,r(t.profile.studentName),1)]),e("tr",null,[l[7]||(l[7]=e("td",{class:"label-cell"},"E-mail",-1)),e("td",X,r(t.profile.email),1)]),l[10]||(l[10]=e("tr",null,[e("td",{class:"label-cell"},"학생구분"),e("td",{class:"value-cell one-cell"},"대학생")],-1)),e("tr",null,[l[8]||(l[8]=e("td",{class:"label-cell"},"최종등록연도",-1)),e("td",q,r(t.profile.year),1)]),e("tr",null,[l[9]||(l[9]=e("td",{class:"label-cell"},"학적상태",-1)),e("td",ee,r(t.profile.status),1)])])])]),e("div",le,[e("table",null,[e("tr",null,[l[11]||(l[11]=e("td",{class:"label-cell"},"학년",-1)),e("td",te,r(t.profile.grade),1)]),e("tr",null,[l[13]||(l[13]=e("td",{class:"label-cell",rowspan:"2"},"소속",-1)),l[14]||(l[14]=e("td",{class:"label-cell"},"학부(과)",-1)),e("td",se,[z(e("select",{"onUpdate:modelValue":l[0]||(l[0]=d=>u.department=d)},l[12]||(l[12]=[e("option",null,"선택",-1),e("option",null,"자연융합학부",-1),e("option",null,"공학시스템학부",-1)]),512),[[D,u.department]])])]),e("tr",null,[l[15]||(l[15]=e("td",{class:"label-cell"},"전공",-1)),e("td",ae,r(t.profile.deptName),1)]),e("tr",null,[l[16]||(l[16]=e("td",{class:"label-cell"},"담당교수",-1)),e("td",oe,r(t.profile.professorName),1)]),e("tr",null,[l[17]||(l[17]=e("td",{class:"label-cell"},"학기",-1)),e("td",ie,r(t.profile.semester),1)]),e("tr",null,[l[18]||(l[18]=e("td",{class:"label-cell"},"졸업충족학점",-1)),e("td",ne,r(t.profile.totalCredits)+"(이수) / 130(총) ",1)])])])])])])],64))}},de=y(re,[["__scopeId","data-v-11421cc1"]]),ce={class:"content"},ue={__name:"StudentRecord",setup(t){const i=A();T(),console.log("로그인 상태:",i.state.checked),console.log("로그인 아이디:",i.state.loggedIn);const n=p({}),a=p([]);return h(async()=>{var c;try{const s=await P();a.value=s.data||[];const u=await B();n.value=u.data||{},console.log("프로필 데이터:",n.value)}catch(s){console.error("에러:",s),((c=s.response)==null?void 0:c.status)===401&&console.log("로그인이 필요합니다")}}),(c,s)=>(v(),m("div",ce,[I(de,{profile:n.value},null,8,["profile"]),I(R,{grades:a.value,profile:n.value},null,8,["grades","profile"])]))}},ge=y(ue,[["__scopeId","data-v-dda7542c"]]);export{ge as default};
