import{O as g,b as u,q as m,k as C,R as L,S as I,U as b,e as R,o as B,h as N,C as d,a as n,H as p,W as k,T as E}from"./index-D6WQuHd6.js";import{S as H,_ as f}from"./CourseTable-BxwlLxoZ.js";const q=l=>g.post("/student/sugang",l),D=l=>g.delete(`/student/sugang/${l}`),F={class:"creditInfo"},M={class:"credit-box"},$={__name:"Enrollment",setup(l){const i=u([]),v=u([]),s=u([]),r=u([]),h=m(()=>r.value.reduce((a,e)=>a+e.credit,0)),S=m(()=>r.value.length);C(async()=>{const a=await L();i.value=a.data;const e=await I();v.value=e.data;const t=await b();r.value=t.data});const x=async a=>{const e=await E(a);s.value=e.data.map(t=>(t.enrolled=r.value.some(o=>o.courseId===t.courseId),t))},y=async a=>{const e={courseId:a.courseId};if(confirm("수강신청을 하시겠습니까?"))try{const t=await q(e);if(t.status===200){const o=t.data,c=s.value.findIndex(_=>_.courseId===o.courseId);c!==-1&&(s.value[c].remStd=o.remStd,s.value[c].enrolled=!0),r.value.push(o),alert("수강신청이 완료되었습니다.")}}catch(t){switch(t.response.data.code){case 4002:alert("정원 초과! 수강신청에 실패하였습니다.");break;case 5001:alert("서버 오류! 수강신청에 실패하였습니다.");break;default:alert("오류가 발생하였습니다.")}}},w=async a=>{if(confirm("수강신청을 취소하시겠습니까?"))try{await D(a),r.value=r.value.filter(t=>t.courseId!==a);const e=s.value.findIndex(t=>t.courseId===a);e!==-1&&(s.value[e].enrolled=!1,s.value[e].remStd+=1),alert("수강신청이 취소되었습니다.")}catch(e){alert("오류가 발생하였습니다. 현재 이 강의는 출석테이블이랑 연동되어 있어서 수강취소가 안 됨. db 수정필요"),console.error(e)}};return(a,e)=>(B(),R(k,{title:"수강 신청"},{default:N(()=>[d(H,{state:!0,departments:i.value,enrollment:!0,semester:1,onSearch:x},null,8,["departments"]),e[2]||(e[2]=n("h5",{class:"fw-bold mt-3"},"개설 과목 목록",-1)),d(f,{courseList:s.value,maxHeight:"500px",show:{professorName:!0,remStd:!0,enroll:!0,cancel:!1,deptName:!0},onEnroll:y},null,8,["courseList"]),n("div",F,[e[1]||(e[1]=n("h5",{class:"fw-bold mt-2 mb-0.3rem"},"신청 내역",-1)),n("div",M,[e[0]||(e[0]=n("span",null,"최대 학점: 18학점",-1)),n("span",null,"신청 학점: "+p(h.value)+"학점",1),n("span",null,"신청 과목 수: "+p(S.value)+"개",1)])]),d(f,{courseList:r.value,maxHeight:"500px",show:{professorName:!0,remStd:!0,enroll:!1,cancel:!0,deptName:!1},onCancel:w},null,8,["courseList"])]),_:1,__:[2]}))}};export{$ as default};
