import{P as b,_ as B,j as q,R as z,q as x,r as o,t as H,k as J,c as r,o as c,b as t,g as A,J as g,e as C,v as K,M as P,F as V,E as G,H as i}from"./index-BYEgPVgA.js";import{g as O}from"./scheduleService-YwOhdZZq.js";const Q=u=>b.get(`/semesters/${u}/next`).then(a=>a.data.semesterId),W=u=>b.post("/applications",u).catch(a=>a.response),X=u=>b.get("/application/me",{params:u}).catch(a=>a.response),Y=u=>b.patch(`/application/${u}/cancel`).catch(a=>a.response),Z={class:"white-box"},j={class:"form-grid"},tt=["value"],et=["value"],lt={class:"toggle"},st={class:"inline"},at=["value"],nt={key:0,class:"muted"},ot={class:"inline"},ut=["value"],it={class:"actions"},dt=["disabled"],rt={class:"white-box"},ct={class:"list-head"},vt={class:"filter"},pt={class:"grid"},mt={key:0},ft=["onClick"],gt={key:1,class:"muted"},bt={__name:"Application",setup(u){const a=q(),{semesterId:y}=z(a),D=x(()=>a.studentNumber??a.loginId??"-"),L=x(()=>a.deptName??a.state.deptName??"-"),v=o("LEAVE"),m=o(""),h=o(null),d=o(null),_=o(!1),w=o(!1),$=s=>s==="LEAVE"?"휴학신청":"복학신청",E=(s,e)=>{var l,n;return s?(n=(l=s[e]??s[`${e}_datetime`]??s[`${e}Date`]??"")==null?void 0:l.toString())==null?void 0:n.slice(0,10):""};async function R(){if(y.value){_.value=!0;try{if(h.value=await Q(Number(y.value)),!h.value){d.value=null;return}d.value=await O({semesterId:h.value,type:$(v.value)})}finally{_.value=!1}}}H([y,v],R,{immediate:!0});const I=x(()=>!!(d.value&&d.value.scheduleId)&&!w.value);async function M(){var s,e,l;if(I.value){w.value=!0;try{await W({scheduleId:d.value.scheduleId,reason:((s=m.value)==null?void 0:s.trim())||null}),alert("신청이 접수되었습니다."),m.value="",await p()}catch(n){alert(((l=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:l.message)??"신청 중 오류가 발생했습니다.")}finally{w.value=!1}}}const k=o([]),f=o(""),N=o(!1);async function p(){N.value=!0;try{const{data:s}=await X(f.value?{status:f.value}:void 0);k.value=s??[]}finally{N.value=!1}}J(p);async function T(s){var e,l;if(confirm("신청을 취소하시겠습니까?"))try{await Y(s),await p()}catch(n){alert(((l=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:l.message)??"취소 중 오류가 발생했습니다.")}}const U=s=>s==="휴학신청"?"휴학":s==="복학신청"?"복학":s,S=s=>s?s.toString().slice(0,10):"-",F=s=>({"badge pending":s==="처리중","badge ok":s==="승인","badge reject":s==="거부"});return(s,e)=>(c(),r(V,null,[t("div",Z,[e[10]||(e[10]=t("h2",{class:"page-title"},"휴·복학 신청",-1)),e[11]||(e[11]=t("p",{class:"desc"},"신청서를 작성한 후, [제출] 버튼을 눌러주세요. 제출이 완료되면 아래에 신청 내역이 조회 됩니다.",-1)),t("div",j,[e[4]||(e[4]=t("label",null,"학번",-1)),t("input",{value:D.value,readonly:""},null,8,tt),e[5]||(e[5]=t("label",null,"학과",-1)),t("input",{value:L.value,readonly:""},null,8,et),e[6]||(e[6]=t("label",null,"신청 구분",-1)),t("div",lt,[t("button",{type:"button",class:g({on:v.value==="LEAVE"}),onClick:e[0]||(e[0]=l=>v.value="LEAVE")},"휴학",2),t("button",{type:"button",class:g({on:v.value==="RETURN"}),onClick:e[1]||(e[1]=l=>v.value="RETURN")},"복학",2)]),e[7]||(e[7]=t("label",null,"시작일",-1)),t("div",st,[t("input",{value:E(d.value,"startDate"),readonly:""},null,8,at),_.value?(c(),r("span",nt,"불러오는 중…")):C("",!0)]),e[8]||(e[8]=t("label",null,"종료일 (휴학인 경우)",-1)),t("div",ot,[t("input",{value:E(d.value,"endDate"),readonly:""},null,8,ut)]),e[9]||(e[9]=t("label",null,"상세 사유",-1)),A(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=l=>m.value=l),rows:"3",placeholder:"구체적인 사유를 입력하세요"},null,512),[[K,m.value]])]),t("div",it,[t("button",{class:"primary",disabled:!I.value,onClick:M},"신청 제출",8,dt)])]),t("div",rt,[t("div",ct,[t("div",vt,[A(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>f.value=l),onChange:p},e[12]||(e[12]=[t("option",{value:""},"상태/전체",-1),t("option",{value:"처리중"},"처리중",-1),t("option",{value:"승인"},"승인",-1),t("option",{value:"거부"},"거부",-1)]),544),[[P,f.value]])]),t("button",{class:"ghost",onClick:p},"조회")]),t("div",{class:g(["table-wrap",{loading:N.value}])},[t("table",pt,[e[14]||(e[14]=t("thead",null,[t("tr",null,[t("th",null,"학년도"),t("th",null,"학기"),t("th",null,"신청구분"),t("th",null,"변동 사유"),t("th",null,"학과"),t("th",null,"신청일자"),t("th",null,"접수일자"),t("th",null,"접수여부"),t("th",null,"액션")])],-1)),t("tbody",null,[k.value.length===0?(c(),r("tr",mt,e[13]||(e[13]=[t("td",{colspan:"9",class:"empty"},"조회된 내역이 없습니다.",-1)]))):C("",!0),(c(!0),r(V,null,G(k.value,l=>(c(),r("tr",{key:l.appId},[t("td",null,i(l.year),1),t("td",null,i(l.semester==="1"?"1학기":"2학기"),1),t("td",null,i(U(l.scheduleType)),1),t("td",null,i(l.reason||"-"),1),t("td",null,i(l.deptName||"-"),1),t("td",null,i(S(l.submittedAt)),1),t("td",null,i(S(l.submittedAt)),1),t("td",null,[t("span",{class:g(F(l.status))},i(l.status),3)]),t("td",null,[l.status==="처리중"?(c(),r("button",{key:0,class:"danger ghost",onClick:n=>T(l.appId)},"취소하기",8,ft)):(c(),r("span",gt,"처리완료"))])]))),128))])])],2)])],64))}},_t=B(bt,[["__scopeId","data-v-429f8931"]]);export{_t as default};
